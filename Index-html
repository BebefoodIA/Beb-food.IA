<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Beb√©Food IA</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="bg-gray-100">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- CONFIGURA√á√ÉO ---
        const API_KEY = "AIzaSyCU_3CjkJXn8TwpPB7TTkvhrkGZQ0wIAmg"; 

        const callGemini = async (prompt) => {
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${API_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }],
                        systemInstruction: { parts: [{ text: "Voc√™ √© Jeey, assistente carinhosa de nutri√ß√£o para beb√™s. Responda em Portugu√™s com emojis." }] }
                    })
                });
                const data = await response.json();
                return data.candidates[0].content.parts[0].text;
            } catch (err) {
                return "Ops! Tive um problema para pensar agora. Tente de novo?";
            }
        };

        // Componente de √çcone corrigido para funcionar com a biblioteca Lucide UMD
        const Icon = ({ name, size = 20, className = "" }) => {
            const iconRef = useRef(null);

            useEffect(() => {
                if (window.lucide && iconRef.current) {
                    // Limpa o conte√∫do anterior
                    iconRef.current.innerHTML = '';
                    
                    // Cria o elemento de √≠cone conforme a API da lucide-web
                    const iconElement = document.createElement('i');
                    iconElement.setAttribute('data-lucide', name.toLowerCase().replace(/([a-z0-9])([A-Z])/g, '$1-$2'));
                    if (className) iconElement.className = className;
                    iconElement.style.width = `${size}px`;
                    iconElement.style.height = `${size}px`;
                    
                    iconRef.current.appendChild(iconElement);
                    window.lucide.createIcons({
                        attrs: {
                            strokeWidth: 2,
                            width: size,
                            height: size
                        }
                    });
                }
            }, [name, size, className]);

            return <span ref={iconRef} className="inline-flex items-center justify-center"></span>;
        };

        function App() {
            const [user, setUser] = useState(null);
            const [tab, setTab] = useState('home');
            const [chat, setChat] = useState([{ role: 'bot', text: 'Ol√°! Sou a Jeey. Como posso ajudar seu beb√© hoje? üë∂' }]);
            const [input, setInput] = useState('');
            const [loading, setLoading] = useState(false);
            const chatEndRef = useRef(null);

            const scrollToBottom = () => {
                chatEndRef.current?.scrollIntoView({ behavior: "smooth" });
            };

            useEffect(() => {
                scrollToBottom();
            }, [chat]);

            if (!user) {
                return (
                    <div className="min-h-screen flex items-center justify-center p-6 bg-emerald-50">
                        <div className="bg-white p-8 rounded-[2rem] shadow-xl w-full max-w-md text-center border border-emerald-100">
                            <div className="w-20 h-20 bg-emerald-100 text-emerald-600 rounded-full flex items-center justify-center mx-auto mb-6">
                                <Icon name="ChefHat" size={40} />
                            </div>
                            <h1 className="text-3xl font-bold text-gray-800 mb-2">Beb√©Food.IA</h1>
                            <p className="text-gray-500 mb-8">Introdu√ß√£o alimentar guiada por intelig√™ncia artificial</p>
                            <button 
                                onClick={() => setUser({ name: 'M√£e', isPremium: true })}
                                className="w-full bg-emerald-500 text-white py-4 rounded-2xl font-bold shadow-lg shadow-emerald-200 active:scale-95 transition-all hover:bg-emerald-600"
                            >
                                Come√ßar Agora
                            </button>
                        </div>
                    </div>
                );
            }

            const sendChat = async () => {
                if (!input.trim() || loading) return;
                const userMsg = { role: 'user', text: input };
                setChat(prev => [...prev, userMsg]);
                setInput('');
                setLoading(true);
                const res = await callGemini(input);
                setChat(prev => [...prev, { role: 'bot', text: res }]);
                setLoading(false);
            };

            return (
                <div className="max-w-md mx-auto bg-white min-h-screen relative flex flex-col shadow-2xl">
                    <header className="p-6 flex justify-between items-center border-b sticky top-0 bg-white z-10">
                        <div>
                            <h2 className="font-bold text-lg text-gray-800">Ol√°, {user.name}!</h2>
                            <p className="text-xs text-emerald-500 font-semibold">Plano Premium Ativo ‚ú®</p>
                        </div>
                        <div className="w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center text-gray-600 border border-gray-200">
                            <Icon name="User" size={20} />
                        </div>
                    </header>

                    <main className="flex-1 overflow-y-auto p-4 hide-scrollbar pb-28">
                        {tab === 'home' && (
                            <div className="space-y-6 animate-in fade-in duration-500">
                                <div className="bg-gradient-to-br from-emerald-500 to-teal-600 p-6 rounded-[2rem] text-white shadow-lg shadow-emerald-100">
                                    <h3 className="font-bold text-xl mb-1">Receita do Dia üçé</h3>
                                    <p className="text-sm opacity-90 mb-4">Papinha de Ma√ß√£ e Canela (Anti-c√≥lica)</p>
                                    <button className="bg-white text-emerald-600 px-5 py-2.5 rounded-xl font-bold text-xs uppercase tracking-wider shadow-sm">Ver Passo a Passo</button>
                                </div>
                                <div className="grid grid-cols-2 gap-4">
                                    <div className="bg-orange-50 p-5 rounded-2xl border border-orange-100 flex flex-col items-center text-center">
                                        <div className="p-3 bg-white rounded-full shadow-sm mb-3">
                                            <Icon name="Calendar" className="text-orange-500" />
                                        </div>
                                        <p className="text-xs font-bold text-orange-700">Card√°pio Semanal</p>
                                    </div>
                                    <div className="bg-blue-50 p-5 rounded-2xl border border-blue-100 flex flex-col items-center text-center">
                                        <div className="p-3 bg-white rounded-full shadow-sm mb-3">
                                            <Icon name="Stethoscope" className="text-blue-500" />
                                        </div>
                                        <p className="text-xs font-bold text-blue-700">Dicas da Pediatra</p>
                                    </div>
                                </div>
                            </div>
                        )}

                        {tab === 'jeey' && (
                            <div className="flex flex-col h-full space-y-4">
                                <div className="flex-1 space-y-4">
                                    {chat.map((m, i) => (
                                        <div key={i} className={`flex ${m.role === 'user' ? 'justify-end' : 'justify-start'}`}>
                                            <div className={`p-4 rounded-2xl max-w-[85%] text-sm shadow-sm ${m.role === 'user' ? 'bg-emerald-500 text-white rounded-tr-none' : 'bg-gray-100 text-gray-800 rounded-tl-none border border-gray-200'}`}>
                                                {m.text}
                                            </div>
                                        </div>
                                    ))}
                                    {loading && (
                                        <div className="flex items-center gap-2 text-emerald-500 font-bold text-xs">
                                            <div className="flex gap-1">
                                                <span className="animate-bounce">.</span>
                                                <span className="animate-bounce delay-75">.</span>
                                                <span className="animate-bounce delay-150">.</span>
                                            </div>
                                            Jeey est√° pensando...
                                        </div>
                                    )}
                                    <div ref={chatEndRef} />
                                </div>
                                <div className="flex gap-2 sticky bottom-0 bg-white py-4">
                                    <input 
                                        className="flex-1 bg-gray-50 border border-gray-200 p-4 rounded-2xl text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500/20" 
                                        placeholder="Tire sua d√∫vida com a Jeey..."
                                        value={input}
                                        onChange={e => setInput(e.target.value)}
                                        onKeyPress={e => e.key === 'Enter' && sendChat()}
                                    />
                                    <button 
                                        onClick={sendChat} 
                                        disabled={loading}
                                        className="bg-emerald-500 text-white p-4 rounded-2xl shadow-lg shadow-emerald-100 hover:bg-emerald-600 disabled:bg-gray-300 active:scale-90 transition-all"
                                    >
                                        <Icon name="Send" size={20} />
                                    </button>
                                </div>
                            </div>
                        )}
                    </main>

                    <nav className="fixed bottom-0 w-full max-w-md bg-white/90 backdrop-blur-md border-t border-gray-100 flex justify-around p-4 shadow-[0_-10px_20px_rgba(0,0,0,0.02)] z-30">
                        <button onClick={() => setTab('home')} className={`p-2 transition-colors ${tab === 'home' ? 'text-emerald-500' : 'text-gray-400 hover:text-gray-600'}`}>
                            <Icon name="Home" />
                        </button>
                        <button onClick={() => setTab('jeey')} className={`p-2 transition-colors ${tab === 'jeey' ? 'text-emerald-500' : 'text-gray-400 hover:text-gray-600'}`}>
                            <Icon name="MessageCircle" />
                        </button>
                        <button onClick={() => setTab('recipes')} className={`p-2 transition-colors ${tab === 'recipes' ? 'text-emerald-500' : 'text-gray-400 hover:text-gray-600'}`}>
                            <Icon name="BookOpen" />
                        </button>
                        <button onClick={() => setTab('settings')} className={`p-2 transition-colors ${tab === 'settings' ? 'text-emerald-500' : 'text-gray-400 hover:text-gray-600'}`}>
                            <Icon name="Settings" />
                        </button>
                    </nav>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
